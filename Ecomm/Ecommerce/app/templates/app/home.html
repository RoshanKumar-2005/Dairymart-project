{% extends 'app/base.html' %}
{% load static %}
{% block title %}Home{% endblock title %}

{% block banner-slider %}
<div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="{% static 'app/images/banner/b1.png' %}" class="d-block w-100" alt="b1">
    </div>
    <div class="carousel-item">
      <img src="{% static 'app/images/banner/b2.png' %}" class="d-block w-100" alt="b2">
    </div>
    <div class="carousel-item">
      <img src="{% static 'app/images/banner/b3.png' %}" class="d-block w-100" alt="b3">
    </div>
    <div class="carousel-item">
      <img src="{% static 'app/images/banner/b4.png' %}" class="d-block w-100" alt="b4">
    </div>
  </div>
</div>
{% endblock banner-slider %}

{% block description %}
<div class="container">
  <div class="row text-center bg-success p-5 text-white border-bottom shadow">
    <h1>Products</h1>
    <small class="fs-5">
      SR Dairy Products is a professionally managed dairy enterprise committed to delivering premium-quality and hygienic dairy products to consumers. 
      Established with a vision to promote health, nutrition, and sustainability, the company operates with modern processing facilities and a strong 
      supply chain network that ensures product freshness and purity at every stage.
      <br><br>
      The company specializes in a diverse range of dairy offerings including fresh milk, curd, paneer, butter, ghee, cheese, and flavored milk. 
      Each product is processed under stringent quality control standards and tested to meet regulatory and nutritional requirements.
    </small>
  </div>
</div>
{% endblock description %}

{% block main-content %}
<div class="container py-4">
  <h2 class="text-center mb-4">Dairy Products</h2>

  <div class="row">
    {% for p in products|slice:"2:13:2" %}
    <div class="col-md-4 col-sm-6 mb-4">
      <div class="card text-center shadow-sm p-3 rounded-3 h-100">
        <a href="{% url 'category' p.category %}">
          <img src="{{ p.product_image.url }}" class="img-fluid" alt="{{ p.title }}">
        </a>
        <div class="card-body">
          <h5 class="card-title">{{ p.title }}</h5>
          <p class="fw-bold text-success mb-1">‚Çπ{{ p.discounted_price }}</p>
          <p class="text-muted"><del>‚Çπ{{ p.selling_price }}</del></p>
          <div class="d-flex justify-content-center gap-2 mt-2">
            <a href="{% url 'add_to_cart' p.id %}" class="btn btn-sm btn-primary">üõí Add to Cart</a>

            {% if p.id in wishlist_items %}
              <button class="btn btn-sm btn-danger toggle-wishlist" data-product="{{ p.id }}">‚ù§Ô∏è</button>
            {% else %}
              <button class="btn btn-sm btn-outline-danger toggle-wishlist" data-product="{{ p.id }}">‚ô°</button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
  $(document).on("click", ".toggle-wishlist", function (e) {
    e.preventDefault();
    const button = $(this);
    const productId = button.data("product");

    $.ajax({
      url: "{% url 'toggle_wishlist' %}",
      method: "POST",
      data: {
        product_id: productId,
        csrfmiddlewaretoken: "{{ csrf_token }}",
      },
      success: function (response) {
        if (response.status === "added") {
          button.removeClass("btn-outline-danger").addClass("btn-danger").text("‚ù§Ô∏è");
        } else if (response.status === "removed") {
          button.removeClass("btn-danger").addClass("btn-outline-danger").text("‚ô°");
        }
      },
      error: function () {
        alert("Please login to use wishlist.");
      },
    });
  });
</script>
<br>
{% endblock main-content %}
